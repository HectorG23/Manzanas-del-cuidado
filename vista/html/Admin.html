  <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</head>
<body>
  <h1 class="text-center mt-4, alert alert-success" id="nusuario">Bienvenido</h1> 

  <!--Div para los botontes que muestran cada uno de los cruds-->
  <div class="buttons">
   <!--Boton de registro-->
          <button  id="RegistrarSer" type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
           Registrar Servicios
          </button>
  
    <!--Boton de registro de manzana-->
         <button id="RegistrarMnz"  class="btn btn-outline-success" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
          Registrar manzana
        </button> 

        <div class="position-absolute top-0 end-0 mt-4">
          <button class="btn btn-danger" type="button" id="cerrarsesion">cerrar sesion goda</button>
          </div>

  </div>
  <!-----------------------------------EDITAR SERVICIOS------------------------------------------------------>
  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Editar & Registrar Servicios</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="http://localhost:3000/Registro-Servicios" id="Registro_S" method="post">
            <div>
              <label for="exampleFormControlInput1" class="form-label">Nombre del Servicio</label>
              <input type="text" class="form-control" id="nombre_server" name="nombre_servicios" placeholder="Cocinar">
            </div>
            <div class="mb-3">
              <label for="exampleFormControlInput1" class="form-label">Tipo de servicio</label>
              <input type="text" class="form-control" id="tipo" name="tipo" placeholder="Gastronomia">
            </div>
            <div class="mb-3">
              <button type="submit" name="EnviarRM" id="EnviarRM" value="Registar" class="btn btn-outline-info">Registrar</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
        </div>
        <div> 
          <table class="table2" >
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">N.Servicio</th>
                <th scope="col">Tipo</th>
              </tr>
            </thead>
            <tbody id="EditarSer">
          </tbody>
          </table>
        </div>   
      </div>
    </div>
  </div>
  <div id="FormDiv"></div>
  <!-----------------------------------------Seccion en donde se encuentra las manzans-------------------------->
         <div style="min-height: 120px;">
          <div class="collapse collapse-horizontal" id="collapseWidthExample">
            <div class="card card-body" style="width: 300px;">
            </div>
          </div>
        </div>
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasExampleLabel">Editar Manzanas</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <form action="http://localhost:3000/Registro-Manzanas" id="Registro_M" method="post">
            <div class="mb-3">
                <label for="formGroupExampleInput" class="form-label">Localidad Manzana</label>
                <input type="text" class="form-control" id="nombre_manzana"  name="nombre_manzana" placeholder="Localidad Puente Aranda">
              </div>
              <div class="mb-3">
                <label for="formGroupExampleInput2" class="form-label">Direccion Manzana</label>
                <input type="text" class="form-control" id="direccion" name="direccion" placeholder="calle 34 # 45-78">
                <button type="submit" name="EnviarRM" id="EnviarRM" value="Registar" class="btn btn-outline-info">Registrar</button>
            </div>
            </form>
            <div> 
              <table class="table" >
                <thead>
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Manzana</th>
                    <th scope="col">Dirreci√≥n</th>
                  </tr>
                </thead>
                <tbody id="EditarMnz">
              </tbody>
              </table>
            </div>    
          </div>
        </div>
   



<!--Scriptionano-->
      <script>
        document.addEventListener('DOMContentLoaded',()=>{
            /* const parms = new URLSearchParams(window.location.search);
            const admin = parms.get('admin');
            document.getElementById('administrador').textContent = admin; */

                //Esete espacio es para poder registrar las manzanas 
               /*  const Nombre_M = document.getElementById('Nombre_M');
 */
 const xhrUsuarioS = new XMLHttpRequest();
            xhrUsuarioS.open('POST','/obtener-usuario', true);
            xhrUsuarioS.onreadystatechange=function(){
                if(xhrUsuarioS.status===4){
                    if(xhrUsuarioS.status===200){
                        const usuario = JSON.parse(xhrUsuarioS.responseText)
                        console.log(usuario)
                        document.getElementById('nusuario').textContent=`Bienvenido${usuario}`;
                        
                    }else{
                        console.log("Error, pailas socio")
                    }
                }
                
            }
            xhrUsuarioS.send()

            //Editar Manzana          
            const EditarMnz=document.getElementById('EditarMnz');
            const RegistrarMnz=document.getElementById('RegistrarMnz');
            
            RegistrarMnz.addEventListener('click',()=>{
                const xhr=new XMLHttpRequest();
                xhr.open('POST','/obtener-manzanas',true);
                xhr.setRequestHeader('Content-type','application/json');
                xhr.onreadystatechange=function(){
                    if(xhr.readyState === 4){
                        if(xhr.status === 200){
                            const data=JSON.parse(xhr.responseText);
                           EditarMnz.innerHTML=data.manzanasr.map(indicador=>`
                            <tr>
                              <td>${indicador[0]}</td>
                              <td>${indicador[1]}</td>
                              <td>${indicador[2]}</td>
                              <td>
                                <div >
                                <button  class="btn btn-secondary" type="button">
                                Editar Manzana
                                </button>
                                <ul>
                                <form action="http://localhost:3000/update-manzana" id="Registro_M" method="post">
                                <input type="text" class="form-control" id="id_m" value="${indicador[0]}" name="id_m">
                                <div class="mb-3">
                                <label for="formGroupExampleInput" class="form-label">Localidad Manzana</label>
                                <input type="text" class="form-control" id="nombre_manzana" value="${indicador[1]}" name="nombre_manzana">
                                </div>
                                <div class="mb-3">
                                <label for="formGroupExampleInput2" class="form-label">Direccion Manzana</label>
                                <input type="text" class="form-control" id="direccion" name="direccion" value="${indicador[2]}">
                                </div>
                                <button type="submit" name="EnviarRM" id="EnviarRM" value="Registar" class="btn btn-outline-info">Registrar</button>
                                </form>
                                </ul>        
                                </div>
                                </td>
                                </tr>`).join('') 
                        }else{
                            console.error('Error al obtener manzanas')
                        }
                    }
                };
                xhr.send()
            })

            //Editar Servicios 
              const EditarSer=document.getElementById('EditarSer');
            const RegistrarSer=document.getElementById('RegistrarMnz');
            RegistrarSer.addEventListener('click',()=>{
                const xhr=new XMLHttpRequest();
                xhr.open('POST','/obtener-service',true);
                xhr.setRequestHeader('Content-type','application/json');
                xhr.onreadystatechange=function(){
                    if(xhr.readyState === 4){
                        if(xhr.status === 200){
                            const data=JSON.parse(xhr.responseText);
                           EditarSer.innerHTML=data.manzanasr.map(indica=>`
                            <tr>
                              <td>${indica[1]}</td>
                              <td>${indica[0]}</td>
                              <td>${indica[2]}</td>
                              <td>${indica[0]}</td>
                              <td>
                                <div >
                                <button class="btn btn-secondary" type="button">
                                Editar Manzana
                                </button>
                                <ul>
                                <form action="http://localhost:3000/update-servicio" id="Registro_M" method="post">
                                <input type="text" class="form-control" id="id_m" value="${indica[1]}" name="id_m">
                                <div class="mb-3">
                                <label class="form-label">Localidad Manzana</label>
                                <input type="text" class="form-control" id="Nombre_M" value="${indica[0]}" name="Nombre_M">
                                </div>
                                <div class="mb-3">
                                <label for="formGroupExampleInput2" class="form-label">Direccion Manzana</label>
                                <input type="text" class="form-control" id="direccion" name="direccion" value="${new Date(indica[2]).toLocaleString()}">
                                </div>
                                <div class="mb-4">
                                <label for="formGroupExampleInput2" class="form-label">Direccion Manzana</label>
                                <input type="text" class="form-control" id="direccion" name="direccion" value="${indica[0]}">
                                </div>
                                <button type="submit" name="EnviarSER" id="EnviarSER" value="Registar" class="btn btn-outline-info">Registrar</button>
                                </form>
                                </ul>        
                                </div>
                                </td>
                                </tr>`).join('') 
                        }else{
                            console.error('Error al obtener manzanas')
                        }
                    }
                };
                xhr.send()
            })  

            const deleteser=EditarSer.querySelectorAll('#deleteser')
            deleteser.forEach(button =>{
              button.addEventListener('click', (event)=>{
                event.preventDefault();
                const indicam=button.dataset.id;
                console.log(indicam)
                const xhr=XMLHttpRequest();
                xhr.open('DELETE','/delete-servicio',true)
                xhr.setRequestHeader('content-type','aplication/json')
                xhr.onreadystatechange=function(){
                  if(xhr.readystate===4){
                    if(xhr.status===200){
                      console.log('solicitud eliminada')
                      window.location.reload(false)
                    }else{
                      console.log('error al borrar su solicitud')
                    }}
                    xhr.send(JSON.stringify({indicam}))
                }
              })
            })
            
            const cerrarsesion=document.getElementById('cerrarsesion')
    cerrarsesion.addEventListener('click',()=>{
    const xhrout= new XMLHttpRequest();
    xhrout.open('POST','/log-out',true);
    xhrout.onreadystatechange=function(){
        if(xhrout.readyState===4){
            if(xhrout.status===200){
                window.location.href='http://127.0.0.1:5500/vista/html/index.html'
            }
            else{
                console.error('error al cerrar sesion')
            }
        }
    }
    xhrout.send();
});
window.onload=function(){
    window.history.forward();
};
window.onpageshow=
function(event){
    if(event.persisted){
        window.location.reload();
    }
}

    });
    </script>
</body>
</html>